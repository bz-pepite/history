"use strict";function _interopDefault(n){return n&&"object"==typeof n&&"default"in n?n.default:n}Object.defineProperty(exports,"__esModule",{value:!0});var resolvePathname=_interopDefault(require("resolve-pathname")),valueEqual=_interopDefault(require("value-equal"));require("tiny-warning");var invariant=_interopDefault(require("tiny-invariant"));function _extends(){return(_extends=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a])}return n}).apply(this,arguments)}function addLeadingSlash(n){return"/"===n.charAt(0)?n:"/"+n}function stripLeadingSlash(n){return"/"===n.charAt(0)?n.substr(1):n}function hasBasename(n,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(n)}function stripBasename(n,t){return hasBasename(n,t)?n.substr(t.length):n}function stripTrailingSlash(n){return"/"===n.charAt(n.length-1)?n.slice(0,-1):n}function parsePath(n){var t=n||"/",e="",a="",o=t.indexOf("#");-1!==o&&(a=t.substr(o),t=t.substr(0,o));var r=t.indexOf("?");return-1!==r&&(e=t.substr(r),t=t.substr(0,r)),{pathname:t,search:"?"===e?"":e,hash:"#"===a?"":a}}function createPath(n){var t=n.pathname,e=n.search,a=n.hash,o=t||"/";return e&&"?"!==e&&(o+="?"===e.charAt(0)?e:"?"+e),a&&"#"!==a&&(o+="#"===a.charAt(0)?a:"#"+a),o}function createLocation(n,t,e,a){var o;return"string"==typeof n?(o=parsePath(n)).state=t:(void 0===(o=_extends({},n)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==t&&void 0===o.state&&(o.state=t)),e&&(o.key=e),a?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=resolvePathname(o.pathname,a.pathname)):o.pathname=a.pathname:o.pathname||(o.pathname="/"),o}function locationsAreEqual(n,t){return n.pathname===t.pathname&&n.search===t.search&&n.hash===t.hash&&n.key===t.key&&valueEqual(n.state,t.state)}function createTransitionManager(){var r=null;var a=[];return{setPrompt:function(n){return r=n,function(){r===n&&(r=null)}},confirmTransitionTo:function(n,t,e,a){if(null!=r){var o="function"==typeof r?r(n,t):r;"string"==typeof o?"function"==typeof e?e(o,a):a(!0):a(!1!==o)}else a(!0)},appendListener:function(n){var t=!0;function e(){t&&n.apply(void 0,arguments)}return a.push(e),function(){t=!1,a=a.filter(function(n){return n!==e})}},notifyListeners:function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];a.forEach(function(n){return n.apply(void 0,t)})}}}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement);function getConfirmation(n,t){t(window.confirm(n))}function supportsHistory(){var n=window.navigator.userAgent;return(-1===n.indexOf("Android 2.")&&-1===n.indexOf("Android 4.0")||-1===n.indexOf("Mobile Safari")||-1!==n.indexOf("Chrome")||-1!==n.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function supportsPopStateOnHashChange(){return-1===window.navigator.userAgent.indexOf("Trident")}function supportsGoWithoutReloadUsingHash(){return-1===window.navigator.userAgent.indexOf("Firefox")}function isExtraneousPopstateEvent(n){void 0===n.state&&navigator.userAgent.indexOf("CriOS")}var PopStateEvent="popstate",HashChangeEvent="hashchange";function getHistoryState(){try{return window.history.state||{}}catch(n){return{}}}function createBrowserHistory(n){void 0===n&&(n={}),canUseDOM||invariant(!1);var s=window.history,c=supportsHistory(),t=!supportsPopStateOnHashChange(),e=n.forceRefresh,h=void 0!==e&&e,a=n.getUserConfirmation,o=void 0===a?getConfirmation:a,r=n.keyLength,i=void 0===r?6:r,u=n.basename?stripTrailingSlash(addLeadingSlash(n.basename)):"";function f(n){var t=n||{},e=t.key,a=t.state,o=window.location,r=o.pathname+o.search+o.hash;return u&&(r=stripBasename(r,u)),createLocation(r,a,e)}function l(){return Math.random().toString(36).substr(2,i)}var d=createTransitionManager();function v(n){_extends(S,n),S.length=s.length,d.notifyListeners(S.location,S.action)}function p(n){isExtraneousPopstateEvent(n)||m(f(n.state))}function g(){m(f(getHistoryState()))}var P=!1;function m(t){if(P)P=!1,v();else{d.confirmTransitionTo(t,"POP",o,function(n){n?v({action:"POP",location:t}):function(n){var t=S.location,e=y.indexOf(t.key);-1===e&&(e=0);var a=y.indexOf(n.key);-1===a&&(a=0);var o=e-a;o&&(P=!0,x(o))}(t)})}}var w=f(getHistoryState()),y=[w.key];function H(n){return u+createPath(n)}function x(n){s.go(n)}var L=0;function O(n){1===(L+=n)&&1===n?(window.addEventListener(PopStateEvent,p),t&&window.addEventListener(HashChangeEvent,g)):0===L&&(window.removeEventListener(PopStateEvent,p),t&&window.removeEventListener(HashChangeEvent,g))}var E=!1;var S={length:s.length,action:"POP",location:w,createHref:H,push:function(n,t){var i=createLocation(n,t,l(),S.location);d.confirmTransitionTo(i,"PUSH",o,function(n){if(n){var t=H(i),e=i.key,a=i.state;if(c)if(s.pushState({key:e,state:a},null,t),h)window.location.href=t;else{var o=y.indexOf(S.location.key),r=y.slice(0,-1===o?0:o+1);r.push(i.key),y=r,v({action:"PUSH",location:i})}else window.location.href=t}})},replace:function(n,t){var r="REPLACE",i=createLocation(n,t,l(),S.location);d.confirmTransitionTo(i,r,o,function(n){if(n){var t=H(i),e=i.key,a=i.state;if(c)if(s.replaceState({key:e,state:a},null,t),h)window.location.replace(t);else{var o=y.indexOf(S.location.key);-1!==o&&(y[o]=i.key),v({action:r,location:i})}else window.location.replace(t)}})},go:x,goBack:function(){x(-1)},goForward:function(){x(1)},block:function(n){void 0===n&&(n=!1);var t=d.setPrompt(n);return E||(O(1),E=!0),function(){return E&&(E=!1,O(-1)),t()}},listen:function(n){var t=d.appendListener(n);return O(1),function(){O(-1),t()}}};return S}var HashChangeEvent$1="hashchange",HashPathCoders={hashbang:{encodePath:function(n){return"!"===n.charAt(0)?n:"!/"+stripLeadingSlash(n)},decodePath:function(n){return"!"===n.charAt(0)?n.substr(1):n}},noslash:{encodePath:stripLeadingSlash,decodePath:addLeadingSlash},slash:{encodePath:addLeadingSlash,decodePath:addLeadingSlash}};function getHashPath(){var n=window.location.href,t=n.indexOf("#");return-1===t?"":n.substring(t+1)}function pushHashPath(n){window.location.hash=n}function replaceHashPath(n){var t=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,0<=t?t:0)+"#"+n)}function createHashHistory(n){void 0===n&&(n={}),canUseDOM||invariant(!1);var t=window.history,e=(supportsGoWithoutReloadUsingHash(),n.getUserConfirmation),i=void 0===e?getConfirmation:e,a=n.hashType,o=void 0===a?"slash":a,s=n.basename?stripTrailingSlash(addLeadingSlash(n.basename)):"",r=HashPathCoders[o],c=r.encodePath,h=r.decodePath;function u(){var n=h(getHashPath());return s&&(n=stripBasename(n,s)),createLocation(n)}var f=createTransitionManager();function l(n){_extends(O,n),O.length=t.length,f.notifyListeners(O.location,O.action)}var d=!1,v=null;function p(){var n=getHashPath(),t=c(n);if(n!==t)replaceHashPath(t);else{var e=u(),a=O.location;if(!d&&locationsAreEqual(a,e))return;if(v===createPath(e))return;v=null,function(t){if(d)d=!1,l();else{f.confirmTransitionTo(t,"POP",i,function(n){n?l({action:"POP",location:t}):function(n){var t=O.location,e=w.lastIndexOf(createPath(t));-1===e&&(e=0);var a=w.lastIndexOf(createPath(n));-1===a&&(a=0);var o=e-a;o&&(d=!0,y(o))}(t)})}}(e)}}var g=getHashPath(),P=c(g);g!==P&&replaceHashPath(P);var m=u(),w=[createPath(m)];function y(n){t.go(n)}var H=0;function x(n){1===(H+=n)&&1===n?window.addEventListener(HashChangeEvent$1,p):0===H&&window.removeEventListener(HashChangeEvent$1,p)}var L=!1;var O={length:t.length,action:"POP",location:m,createHref:function(n){return"#"+c(s+createPath(n))},push:function(n,t){var r=createLocation(n,void 0,void 0,O.location);f.confirmTransitionTo(r,"PUSH",i,function(n){if(n){var t=createPath(r),e=c(s+t);if(getHashPath()!==e){v=t,pushHashPath(e);var a=w.lastIndexOf(createPath(O.location)),o=w.slice(0,-1===a?0:a+1);o.push(t),w=o,l({action:"PUSH",location:r})}else l()}})},replace:function(n,t){var o="REPLACE",r=createLocation(n,void 0,void 0,O.location);f.confirmTransitionTo(r,o,i,function(n){if(n){var t=createPath(r),e=c(s+t);getHashPath()!==e&&(v=t,replaceHashPath(e));var a=w.indexOf(createPath(O.location));-1!==a&&(w[a]=t),l({action:o,location:r})}})},go:y,goBack:function(){y(-1)},goForward:function(){y(1)},block:function(n){void 0===n&&(n=!1);var t=f.setPrompt(n);return L||(x(1),L=!0),function(){return L&&(L=!1,x(-1)),t()}},listen:function(n){var t=f.appendListener(n);return x(1),function(){x(-1),t()}}};return O}function clamp(n,t,e){return Math.min(Math.max(n,t),e)}function createMemoryHistory(n){void 0===n&&(n={});var o=n.getUserConfirmation,t=n.initialEntries,e=void 0===t?["/"]:t,a=n.initialIndex,r=void 0===a?0:a,i=n.keyLength,s=void 0===i?6:i,c=createTransitionManager();function h(n){_extends(p,n),p.length=p.entries.length,c.notifyListeners(p.location,p.action)}function u(){return Math.random().toString(36).substr(2,s)}var f=clamp(r,0,e.length-1),l=e.map(function(n){return createLocation(n,void 0,"string"!=typeof n&&n.key||u())}),d=createPath;function v(n){var t=clamp(p.index+n,0,p.entries.length-1),e=p.entries[t];c.confirmTransitionTo(e,"POP",o,function(n){n?h({action:"POP",location:e,index:t}):h()})}var p={length:l.length,action:"POP",location:l[f],index:f,entries:l,createHref:d,push:function(n,t){var a=createLocation(n,t,u(),p.location);c.confirmTransitionTo(a,"PUSH",o,function(n){if(n){var t=p.index+1,e=p.entries.slice(0);e.length>t?e.splice(t,e.length-t,a):e.push(a),h({action:"PUSH",location:a,index:t,entries:e})}})},replace:function(n,t){var e="REPLACE",a=createLocation(n,t,u(),p.location);c.confirmTransitionTo(a,e,o,function(n){n&&(p.entries[p.index]=a,h({action:e,location:a}))})},go:v,goBack:function(){v(-1)},goForward:function(){v(1)},canGo:function(n){var t=p.index+n;return 0<=t&&t<p.entries.length},block:function(n){return void 0===n&&(n=!1),c.setPrompt(n)},listen:function(n){return c.appendListener(n)}};return p}exports.createBrowserHistory=createBrowserHistory,exports.createHashHistory=createHashHistory,exports.createMemoryHistory=createMemoryHistory,exports.createLocation=createLocation,exports.locationsAreEqual=locationsAreEqual,exports.parsePath=parsePath,exports.createPath=createPath;
